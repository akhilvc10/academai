import {
	useCallback,
	useEffect,
	useState,
	type FC,
	type SVGProps,
} from "react";

interface SpeedoMeterSvgProps extends SVGProps<SVGSVGElement> {
	initialLevel: number;
}

const SpeedoMeterSvg: FC<SpeedoMeterSvgProps> = ({ initialLevel }) => {
	const [level, setLevel] = useState(0);
	const [color, setColor] = useState({
		4: "fill-green-400",
		3: "fill-yellow-400",
		2: "fill-orange-400",
		1: "fill-red-400",
	});

	const calculateRotation = useCallback((level: number) => {
		const degreeMap: { [key: number]: number } = {
			0: -125,
			1: -95, // Level 1
			2: -35, // Level 2
			3: 15, // Level 3
			4: 90, // Level 4
		};
		return degreeMap[level] || 0;
	}, []);

	useEffect(() => {
		setLevel(initialLevel);
	}, [initialLevel]);

	useEffect(() => {
		if (level > 0) {
			const baseColorMap = {
				4: "fill-green-400",
				3: "fill-yellow-400",
				2: "fill-orange-400",
				1: "fill-red-400",
			};
			const brightColorMap = {
				4: "fill-[#50F48D]",
				3: "fill-[#FFE216]",
				2: "fill-[#FFA142]",
				1: "fill-[#FF7C7C]",
			};

			const blinkInterval = setInterval(() => {
				setColor((prevColors) => ({
					...prevColors,
					[level]:
						prevColors[level as keyof typeof prevColors] === baseColorMap[level]
							? brightColorMap[level]
							: baseColorMap[level],
				}));
			}, 500);

			return () => clearInterval(blinkInterval);
		}
	}, [level]);

	const rotationDegrees = calculateRotation(level);

	return (
		<svg
			width="240"
			height="139"
			viewBox="0 0 240 139"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
		>
			<title>Speedometer Graphic</title>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M239.581 120.205C239.575 54.1401 186.017 0.585693 119.95 0.585693C53.8839 0.585693 0.325667 54.1401 0.319458 120.205H36.2087C36.215 73.9612 73.705 36.475 119.95 36.475C166.196 36.475 203.686 73.9612 203.692 120.205H239.581Z"
				className={color[4]}
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M36.2087 120.205H0.319336C0.319845 115.009 0.658905 109.798 1.34296 104.602C4.78035 78.492 16.737 54.2463 35.3586 35.6247C53.9802 17.0032 78.2259 5.04647 104.335 1.60908C130.445 -1.82831 156.959 3.44569 179.766 16.6131L161.821 47.6941C145.857 38.4769 127.297 34.7851 109.02 37.1913C90.7433 39.5975 73.7712 47.9672 60.7361 61.0023C47.7011 74.0374 39.3314 91.0094 36.9252 109.286C36.4465 112.922 36.2092 116.569 36.2087 120.205Z"
				className={color[3]}
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M36.2088 120.205H0.319458C0.320173 112.407 1.08334 104.594 2.61817 96.8776C6.97427 74.978 17.3724 54.7346 32.6361 38.4377C47.8998 22.1408 67.4198 10.4409 88.9877 4.66187L98.2765 39.3283C83.179 43.3736 69.515 51.5635 58.8304 62.9713C48.1458 74.3792 40.8671 88.5496 37.8178 103.879C36.7437 109.279 36.2095 114.747 36.2088 120.205Z"
				className={color[2]}
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M36.2087 120.205H0.319458C0.319713 117.603 0.404874 114.997 0.575613 112.392C1.77575 94.0817 7.17203 76.2926 16.347 60.4011L47.428 78.3458C41.0055 89.4698 37.2282 101.922 36.3881 114.74C36.2686 116.562 36.209 118.385 36.2087 120.205Z"
				className={color[1]}
			/>
			<line
				x1="15.2575"
				y1="59.5437"
				x2="47.3753"
				y2="78.3745"
				stroke="white"
				stroke-width="1.10769"
				className="dark:stroke-neutral-950"
			/>
			<line
				x1="88.9655"
				y1="4.65041"
				x2="98.2844"
				y2="39.3156"
				stroke="white"
				stroke-width="1.10769"
				className="dark:stroke-neutral-950"
			/>
			<path
				d="M179.756 16.5738L161.837 47.7037"
				stroke="white"
				stroke-width="1.10769"
				className="dark:stroke-neutral-950"
			/>

			<g
				style={{
					transform: `rotate(${rotationDegrees}deg)`,
					transformOrigin: "119.95px 117.412px",
					transition: "transform 1s ease-out",
				}}
			>
				<path
					d="M118.879 94.3856C119.168 93.2836 120.733 93.2836 121.022 94.3856L125.407 111.095C125.591 111.797 125.061 112.484 124.335 112.484H115.565C114.839 112.484 114.31 111.797 114.494 111.095L118.879 94.3856Z"
					fill="#A8A8A8"
				/>
			</g>

			<circle cx="119.951" cy="117.412" r="4.48067" fill="#D9D9D9" />
			<circle cx="119.95" cy="117.412" r="11.202" fill="#44403c" />
			<circle cx="119.951" cy="117.412" r="4.48067" fill="#A8A8A8" />
			<line
				x1="47.6523"
				y1="119.651"
				x2="53.7872"
				y2="119.651"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="186.409"
				y1="119.651"
				x2="192.254"
				y2="119.651"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="50.2594"
				y1="100.957"
				x2="56.1853"
				y2="102.545"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="57.6158"
				y1="83.5748"
				x2="62.9287"
				y2="86.6422"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="69.2205"
				y1="68.6884"
				x2="73.5585"
				y2="73.0265"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="84.2825"
				y1="57.3134"
				x2="87.3499"
				y2="62.6264"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="101.775"
				y1="50.2243"
				x2="103.363"
				y2="56.1502"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="120.507"
				y1="47.9041"
				x2="120.507"
				y2="54.0389"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="139.201"
				y1="50.511"
				x2="137.613"
				y2="56.4368"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="156.583"
				y1="57.8675"
				x2="153.516"
				y2="63.1804"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="171.469"
				y1="69.4722"
				x2="167.131"
				y2="73.8102"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="182.845"
				y1="84.5343"
				x2="177.532"
				y2="87.6018"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<line
				x1="189.934"
				y1="102.027"
				x2="184.008"
				y2="103.615"
				stroke="#818181"
				stroke-width="1.10769"
			/>
			<path
				d="M10.3688 132.898H13.3692V134.381H8.81799V126.515H10.3688V132.898ZM18.8602 133.684C18.2833 134.254 17.5791 134.538 16.7475 134.538C15.9159 134.538 15.2117 134.254 14.6349 133.684C14.0655 133.107 13.7808 132.403 13.7808 131.571C13.7808 130.74 14.0655 130.039 14.6349 129.47C15.2117 128.893 15.9159 128.605 16.7475 128.605C17.5791 128.605 18.2833 128.893 18.8602 129.47C19.437 130.039 19.7255 130.74 19.7255 131.571C19.7255 132.403 19.437 133.107 18.8602 133.684ZM15.6575 132.684C15.9497 132.976 16.313 133.122 16.7475 133.122C17.182 133.122 17.5454 132.976 17.8376 132.684C18.1297 132.392 18.2758 132.021 18.2758 131.571C18.2758 131.122 18.1297 130.751 17.8376 130.459C17.5454 130.167 17.182 130.021 16.7475 130.021C16.313 130.021 15.9497 130.167 15.6575 130.459C15.3728 130.751 15.2305 131.122 15.2305 131.571C15.2305 132.021 15.3728 132.392 15.6575 132.684ZM26.8525 128.762H28.392L26.6052 134.381H25.223L24.1892 130.976L23.1553 134.381H21.7731L19.9864 128.762H21.5259L22.4811 132.212L23.5037 128.762H24.8747L25.8973 132.223L26.8525 128.762Z"
				fill="black"
				className="dark:fill-white"
			/>
			<path
				d="M215.239 126.515H216.778V134.381H215.239V131.122H212.317V134.381H210.766V126.515H212.317V129.639H215.239V126.515ZM218.892 128.088C218.652 128.088 218.442 128.002 218.262 127.829C218.09 127.65 218.004 127.44 218.004 127.2C218.004 126.96 218.09 126.751 218.262 126.571C218.442 126.391 218.652 126.301 218.892 126.301C219.139 126.301 219.349 126.391 219.521 126.571C219.701 126.751 219.791 126.96 219.791 127.2C219.791 127.44 219.701 127.65 219.521 127.829C219.349 128.002 219.139 128.088 218.892 128.088ZM218.172 134.381V128.762H219.622V134.381H218.172ZM225.253 128.762H226.669V134.111C226.669 134.98 226.38 135.643 225.803 136.1C225.234 136.557 224.545 136.786 223.736 136.786C223.129 136.786 222.593 136.67 222.129 136.437C221.672 136.205 221.32 135.864 221.072 135.415L222.309 134.707C222.593 135.231 223.084 135.493 223.781 135.493C224.238 135.493 224.597 135.374 224.859 135.134C225.122 134.894 225.253 134.553 225.253 134.111V133.504C224.826 134.074 224.226 134.358 223.455 134.358C222.661 134.358 221.994 134.081 221.454 133.527C220.923 132.965 220.657 132.283 220.657 131.482C220.657 130.687 220.926 130.009 221.466 129.448C222.005 128.886 222.668 128.605 223.455 128.605C224.226 128.605 224.826 128.889 225.253 129.459V128.762ZM222.544 132.594C222.844 132.879 223.222 133.021 223.679 133.021C224.136 133.021 224.511 132.879 224.803 132.594C225.103 132.302 225.253 131.931 225.253 131.482C225.253 131.04 225.103 130.676 224.803 130.392C224.511 130.099 224.136 129.953 223.679 129.953C223.222 129.953 222.844 130.099 222.544 130.392C222.252 130.676 222.106 131.04 222.106 131.482C222.106 131.931 222.252 132.302 222.544 132.594ZM231.107 128.605C231.721 128.605 232.227 128.811 232.624 129.223C233.029 129.635 233.231 130.204 233.231 130.931V134.381H231.781V131.111C231.781 130.736 231.68 130.451 231.478 130.257C231.276 130.054 231.006 129.953 230.669 129.953C230.294 129.953 229.995 130.069 229.77 130.302C229.545 130.534 229.433 130.882 229.433 131.347V134.381H227.983V126.515H229.433V129.391C229.785 128.867 230.343 128.605 231.107 128.605Z"
				fill="black"
				className="dark:fill-white"
			/>
		</svg>
	);
};

export default SpeedoMeterSvg;
